---
title: "Events"
description: "All events emitted by AquaLink for building responsive music bots"
icon: "bolt"
---

## All Events

AquaLink emits a variety of events to keep you informed about the state of your music players and Lavalink nodes. You can listen for these events to build a responsive and interactive bot.

## Player Events

### Track Events

<CodeGroup>

```javascript Track Start
client.aqua.on(AqualinkEvents.TrackStart, (player, track) => {
    console.log(`Started playing: ${track.title}`);
    
    const embed = {
        title: 'üéµ Now Playing',
        description: `**${track.title}**\nBy ${track.author}`,
        color: 0x00ff00
    };
    
    const channel = client.channels.cache.get(player.textChannel);
    if (channel) channel.send({ embeds: [embed] });
});
```

```javascript Track End
client.aqua.on(AqualinkEvents.TrackEnd, (player, track, payload) => {
    console.log(`Track ended: ${track.title} (Reason: ${payload})`);
    
    if (payload.reason === 'FINISHED') {
        console.log('Track finished normally');
    } else if (payload.reason === 'STOPPED') {
        console.log('Track was stopped');
    }
});
```

```javascript Track Error
client.aqua.on(AqualinkEvents.TrackError, (player, track, payload) => {
    console.log(`Track error: ${track.title} (Error: ${payload})`);
    
    const channel = client.channels.cache.get(player.textChannel);
    if (channel) channel.send('‚ùå An error occurred while playing the track!');
    
    if (player.queue.length > 0) {
        player.skip();
    }
});
```

```javascript Track Stuck
client.aqua.on(AqualinkEvents.TrackStuck, (player, error, track) => {
    console.log(`Track stuck: ${track.title}`);
    
    const channel = client.channels.cache.get(player.textChannel);
    if (channel) channel.send('‚ö†Ô∏è Track appears to be stuck, skipping...');
    player.skip();
});
```

</CodeGroup>

### Connection Events

<CodeGroup>

```javascript Socket Closed
client.aqua.on(AqualinkEvents.SocketClosed, (player, track, payload) => {
    console.log(`Socket closed: ${payload.code} - ${payload.reason}`);
    
    if (payload.code === 1000) {
        console.log('Normal closure');
    } else {
        console.log('Unexpected closure, attempting reconnect...');
    }
});
```

```javascript Player Destroy
client.aqua.on(AqualinkEvents.PlayerDestroy, (guildId) => {
    console.log(`Player destroyed for guild: ${guildId}`);
});
```

</CodeGroup>

### Lyrics Events

<CodeGroup>

```javascript Lyrics Found
client.aqua.on(AqualinkEvents.LyricsFound, (player, track, payload) => {
    console.log(`Lyrics found for: ${track.title}`);
    
    const embed = {
        title: `üé§ Lyrics - ${track.title}`,
        description: payload.lyrics.substring(0, 2000), 
        color: 0x9932cc
    };
    
    const channel = client.channels.cache.get(player.textChannel);
    if (channel) channel.send({ embeds: [embed] });
});
```

```javascript Lyrics Line
client.aqua.on(AqualinkEvents.LyricsLine, (player, track, payload) => {
    console.log(`Current lyric line: ${payload.line}`);
});
```

```javascript Lyrics Not Found
client.aqua.on(AqualinkEvents.LyricsNotFound, (player, track, payload) => {
    console.log(`No lyrics found for: ${track.title}`);
    
    const channel = client.channels.cache.get(player.textChannel);
    if (channel) channel.send('üìù No lyrics available for this track.');
});
```

</CodeGroup>

### Lyrics Error Handling

When fetching lyrics, you might encounter several HTTP error codes. Here's what they mean:

- **401 Unauthorized**: The request requires user authentication, or the provided credentials are not valid.
- **403 Forbidden**: The server understood the request but is refusing to fulfill it.
- **404 Not Found**: The requested resource could not be located.
- **429 Too Many Requests**: You've exceeded the API's rate limit, often due to too many requests in a short period.

### Lyrics Error Handling

When fetching lyrics, you might encounter several HTTP error codes. Here's what they mean:

- **401 Unauthorized**: The request requires user authentication, or the provided credentials are not valid.
- **403 Forbidden**: The server understood the request but is refusing to fulfill it.
- **404 Not Found**: The requested resource could not be located.
- **429 Too Many Requests**: You've exceeded the API's rate limit, often due to too many requests in a short period.

<Warning>
If you encounter persistent issues, report them in **[Lavalink's server](https://discord.gg/mZKCZWMJ9P)** with proper tags and follow their forum rules.
</Warning>

### Queue Events

```javascript Queue End
client.aqua.on(AqualinkEvents.QueueEnd, (player) => {
    console.log('Queue has ended');
    
    const embed = {
        title: 'üì≠ Queue Empty',
        description: 'The queue has ended. Add more tracks to continue!',
        color: 0xff6b6b
    };
    
    const channel = client.channels.cache.get(player.textChannel);
    if (channel) channel.send({ embeds: [embed] });
    
    setTimeout(() => {
        if (player.queue.length === 0) {
            player.destroy();
        }
    }, 300000);
});
```

## Node Events

### Connection Events

<CodeGroup>

```javascript Node Connect
client.aqua.on(AqualinkEvents.NodeConnect, (node) => {
    console.log(`‚úÖ Node ${node.name} connected`);
    console.log(`Node stats: ${node.stats.players} players, ${node.stats.playingPlayers} playing`);
    
    console.log(`Node ${node.name} (${node.host}:${node.port}) is ready!`);
});
```

```javascript Node Disconnect
client.aqua.on(AqualinkEvents.NodeDisconnect, (node, reason) => {
    console.log(`‚ùå Node ${node.name} disconnected: ${reason}`);
    
    if (reason.code === 1006) {
        console.log('Node disconnected abnormally, attempting reconnect...');
    }
    
    console.warn(`Lavalink node ${node.name} is offline!`);
});
```

```javascript Node Destroy
client.aqua.on(AqualinkEvents.NodeDestroy, (node) => {
    console.log(`üóëÔ∏è Node ${node.name} destroyed`);
    
    console.log(`Cleaned up resources for node: ${node.name}`);
});
```

```javascript Node Error
client.aqua.on(AqualinkEvents.NodeError, (node, error) => {
    console.error(`‚ùå Node ${node.name} error:`, error);
    
    console.error(`Error details:`, {
        node: node.name,
        host: node.host,
        port: node.port,
        error: error.message,
        stack: error.stack
    });
    
    if (error.code === 'ECONNREFUSED') {
        console.log('Connection refused, check if Lavalink server is running');
    }
});
```

</CodeGroup>

## Event Usage Examples

### Building a Status System

```javascript Complete Status Tracking
const playerStates = new Map();

client.aqua.on(AqualinkEvents.TrackStart, (player, track) => {
    playerStates.set(player.guildId, {
        status: 'playing',
        track: track,
        startTime: Date.now()
    });
});

client.aqua.on(AqualinkEvents.TrackEnd, (player, track, payload) => {
    const state = playerStates.get(player.guildId);
    if (state) {
        state.status = 'idle';
        state.lastTrack = track;
        state.endReason = payload.reason;
    }
});

client.aqua.on(AqualinkEvents.PlayerDestroy, (guildId) => {
    playerStates.delete(guildId);
});
```

### Auto-Moderation System

```javascript Auto Skip Bad Tracks
const errorCounts = new Map();

client.aqua.on(AqualinkEvents.TrackError, (player, track, payload) => {
    const trackId = track.encoded;
    const count = errorCounts.get(trackId) || 0;
    errorCounts.set(trackId, count + 1);
    
    if (count >= 2) {
        console.log(`Track ${track.title} has errored ${count + 1} times, removing from queue`);
        player.queue = player.queue.filter(t => t.encoded !== trackId);
    }
    
    player.skip();
});
```

### Health Monitoring

```javascript Node Health Monitor
client.aqua.on(AqualinkEvents.NodeConnect, (node) => {
    console.log(`Node ${node.name} online - Health check starting`);
    
    const healthCheck = setInterval(() => {
        if (node.connected) {
            console.log(`${node.name} Stats:`, {
                players: node.stats.players,
                playing: node.stats.playingPlayers,
                uptime: node.stats.uptime,
                memory: `${Math.round(node.stats.memory.used / 1024 / 1024)}MB`
            });
        } else {
            clearInterval(healthCheck);
        }
    }, 30000); 
});

client.aqua.on(AqualinkEvents.NodeDisconnect, (node) => {
    console.warn(`üö® Node ${node.name} went offline! Failover procedures initiated.`);
});
```

### Basic Bot Setup

```javascript Essential Events Setup
client.aqua.on(AqualinkEvents.NodeConnect, (node) => {
    console.log(`Node connected: ${node.name}`);
});

client.aqua.on(AqualinkEvents.NodeError, (node, error) => {
    console.log(`Node "${node.name}" encountered an error: ${error.message}.`);
});

client.aqua.on(AqualinkEvents.TrackStart, (player, track) => {
    const channel = client.channels.cache.get(player.textChannel);
    if (channel) channel.send(`Now playing: **${track.title}**`);
});

client.aqua.on(AqualinkEvents.QueueEnd, (player) => {
    const channel = client.channels.cache.get(player.textChannel);
    if (channel) channel.send('The queue has ended.');
    player.destroy();
});
```

<Warning>
Remember to handle events gracefully and avoid blocking the event loop with heavy operations. Use `setImmediate()` or `process.nextTick()` for intensive tasks within event handlers.
</Warning>

<Tip>
Events are emitted in real-time, making them perfect for building live status displays, logging systems, and responsive user interfaces. Combine multiple events to create comprehensive monitoring and control systems.
</Tip>
